<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8">
  <title>Brúixola Simple</title>
  <style>
    body {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background: #f0f0f0;
    }
    #compass {
      background: #fff;
      border-radius: 50%;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border: 2px solid #333;
      display: block;
    }
  </style>
</head>
<body>
  <canvas id="compass" width="40" height="40"></canvas>
  <script>
    const canvas = document.getElementById('compass');
    const ctx = canvas.getContext('2d');
    const center = 20; // Centre de la brúixola
    const radius = 18; // Radi lleugerament menor per deixar marge
    const needleLength = 10; // Longitud de la línia (20px total, 10px cap amunt)

    // Dibuixa la brúixola i l'agulla
    function drawCompass(angle = 0) {
      ctx.clearRect(0, 0, 40, 40);

      // Cercle exterior
      ctx.beginPath();
      ctx.arc(center, center, radius, 0, 2 * Math.PI);
      ctx.strokeStyle = '#333';
      ctx.lineWidth = 2;
      ctx.stroke();

      // Marca la N
      ctx.font = '8px Arial';
      ctx.fillStyle = '#c00';
      ctx.textAlign = 'center';
      ctx.textBaseline = 'top';
      ctx.fillText('N', center, 2);

      // Agulla (nord)
      ctx.save();
      ctx.translate(center, center);
      ctx.rotate(angle);

      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(0, -needleLength);
      ctx.strokeStyle = '#c00';
      ctx.lineWidth = 3;
      ctx.stroke();

      ctx.restore();
    }

    // Inicialitza la brúixola a 0º
    drawCompass(0);

    // Gestiona l'orientació del dispositiu
    if (window.DeviceOrientationEvent) {
      window.addEventListener('deviceorientation', function(event) {
        // event.alpha dona la rotació respecte al nord (en graus)
        let heading = event.alpha;
        if (typeof event.webkitCompassHeading !== "undefined") {
          // Safari i iOS
          heading = event.webkitCompassHeading;
        }
        // Converteix graus a radians i ajusta perquè 0 apunti cap amunt
        const angle = ((heading || 0) * Math.PI / 180) * -1;
        drawCompass(angle);
      }, true);
    } else {
      // Si no és compatible, mostra la brúixola fixa
      drawCompass(0);
    }
  </script>
</body>
</html>
