<!DOCTYPE html>
<html lang="ca">
<head>
<meta charset="UTF-8">
<title>Gràfic Temperatures</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #e9f5ff;
  color: #222;
  padding: 2em;
}
.chart-container {
  max-width: 1050px;
  margin: 2em auto;
  background: #fff;
  border-radius: 8px;
  box-shadow: 0 2px 8px rgba(0,0,0,0.1);
  padding: 2em 1em;
}
</style>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="chart-container">
  <h3 style="text-align:center;">Temperatures màximes i mínimes últims 30 dies</h3>
  <canvas id="tempChart" width="900" height="350"></canvas>
</div>
<script>
const municipis = [
  { nom: "Espluga de Francolí", lat: 41.3862, lon: 1.1022 },
  { nom: "Les Borges Blanques", lat: 41.5194, lon: 0.8670 }
];
function getHistoricalUrl(lat, lon, start, end) {
  return `https://archive-api.open-meteo.com/v1/archive?latitude=${lat}&longitude=${lon}&daily=temperature_2m_max,temperature_2m_min&start_date=${start}&end_date=${end}&timezone=Europe/Madrid`;
}
function fetchAndDrawTempChart() {
  const today = new Date();
  const endDate = today.toISOString().slice(0,10);
  const startDate = new Date(today.getTime() - 29*24*3600*1000).toISOString().slice(0,10);

  Promise.all(municipis.map(m =>
    fetch(getHistoricalUrl(m.lat, m.lon, startDate, endDate)).then(r => r.json())
  )).then(histResults => {
    const dates30 = histResults[0].daily.time;
    const tempMax0 = histResults[0].daily.temperature_2m_max;
    const tempMin0 = histResults[0].daily.temperature_2m_min;
    const tempMax1 = histResults[1].daily.temperature_2m_max;
    const tempMin1 = histResults[1].daily.temperature_2m_min;

    const ctxT = document.getElementById('tempChart').getContext('2d');
    new Chart(ctxT, {
      type: 'line',
      data: {
        labels: dates30,
        datasets: [
          {
            label: 'Espluga de Francolí (màxima)',
            data: tempMax0,
            borderColor: 'rgba(54, 162, 235, 1)',
            backgroundColor: 'rgba(54, 162, 235, 0.15)',
            tension: 0.3,
            pointRadius: 0
          },
          {
            label: 'Espluga de Francolí (mínima)',
            data: tempMin0,
            borderColor: 'rgba(54, 162, 235, 0.7)',
            backgroundColor: 'rgba(54, 162, 235, 0.07)',
            tension: 0.3,
            pointRadius: 0
          },
          {
            label: 'Les Borges Blanques (màxima)',
            data: tempMax1,
            borderColor: 'rgba(255, 99, 132, 1)',
            backgroundColor: 'rgba(255, 99, 132, 0.15)',
            tension: 0.3,
            pointRadius: 0
          },
          {
            label: 'Les Borges Blanques (mínima)',
            data: tempMin1,
            borderColor: 'rgba(255, 99, 132, 0.7)',
            backgroundColor: 'rgba(255, 99, 132, 0.07)',
            tension: 0.3,
            pointRadius: 0
          }
        ]
      },
      options: {
        responsive: true,
        scales: {
          x: { title: { display: true, text: 'Data' } },
          y: { title: { display: true, text: '°C' }, beginAtZero: false }
        }
      }
    });
  }).catch(error => {
    document.getElementById('tempChart').insertAdjacentHTML('afterend',
      "<div style='color:#c00;text-align:center;'>No s'han pogut carregar les dades.</div>");
    console.error(error);
  });
}
fetchAndDrawTempChart();
</script>
</body>
</html>
