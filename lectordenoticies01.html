<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/ico" href="https://www.lavanguardia.com/favicon.ico"/>
	<link rel="shortcut icon" href="https://www.lavanguardia.com/favicon.ico" />

	<link rel="apple-touch-icon" sizes="180x180" href="https://www.lavanguardia.com/xlv-apple-icon-180x180.png.pagespeed.ic.YwI-K2mNIG.webp" />
	<link rel="icon" type="image/png" sizes="192x192" href="https://www.lavanguardia.com/xlv-android-icon-192x192.png.pagespeed.ic._ODxVr2OkP.webp" />
	<link rel="icon" type="image/png" sizes="32x32" href="https://www.lavanguardia.com/xlv-favicon-32x32.png.pagespeed.ic.5937V8MMmI.webp" />
	<link rel="icon" type="image/png" sizes="16x16" href="https://www.lavanguardia.com/xlv-favicon-16x16.png.pagespeed.ic.cJHTo1iqYV.webp" />

    <title>Lector de Notícies - La Vanguardia</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f7fa;
            color: #333;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        header {
            background: linear-gradient(135deg, #1a3a8f 0%, #2a5bd7 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        h1 {
            font-size: 2.2rem;
            margin-bottom: 10px;
        }

        .subtitle {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .input-section {
            padding: 25px;
            background-color: #f8f9fa;
            border-bottom: 1px solid #eaeaea;
        }

        .url-input {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1rem;
            margin-bottom: 15px;
        }

        .btn {
            background-color: #1a3a8f;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .btn:hover {
            background-color: #152c6e;
        }

        .btn:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        .content-section {
            padding: 30px;
        }

        .article-header {
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid #eaeaea;
        }

        .article-title {
            font-size: 1.8rem;
            color: #1a3a8f;
            margin-bottom: 10px;
        }

        .article-subtitle {
            font-size: 1.2rem;
            color: #555;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .meta-info {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
            color: #666;
            font-size: 0.9rem;
        }

        .meta-item {
            display: flex;
            align-items: center;
        }

        .article-images {
            width: 100%;
            margin: 20px 0;
        }

        .article-image {
            margin-bottom: 30px;
            text-align: center;
        }

        .article-image img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .image-caption {
            font-style: italic;
            color: #666;
            margin-top: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .image-counter {
            display: inline-block;
            background-color: #1a3a8f;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            margin-bottom: 8px;
        }

        .summary {
            background-color: #f0f7ff;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 25px;
            border-left: 4px solid #1a3a8f;
        }

        .summary h3 {
            color: #1a3a8f;
            margin-bottom: 10px;
        }

        .article-body {
            font-size: 1.05rem;
            line-height: 1.7;
        }

        .article-body p {
            margin-bottom: 15px;
        }

        .keywords {
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eaeaea;
        }

        .keywords span {
            display: inline-block;
            background-color: #eef2ff;
            color: #1a3a8f;
            padding: 5px 12px;
            border-radius: 20px;
            margin-right: 8px;
            margin-bottom: 8px;
            font-size: 0.85rem;
        }

        .loading {
            text-align: center;
            padding: 20px;
            display: none;
        }

        .spinner {
            border: 4px solid rgba(0, 0, 0, 0.1);
            border-left-color: #1a3a8f;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 15px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .error {
            background-color: #ffeaea;
            color: #d63031;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
            border-left: 4px solid #d63031;
        }

        .images-info {
            background-color: #f8f9fa;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 15px 0;
            font-size: 0.9rem;
            color: #666;
        }

        footer {
            text-align: center;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
            border-top: 1px solid #eaeaea;
            margin-top: 30px;
        }

        @media (max-width: 768px) {
            .container {
                border-radius: 0;
            }

            h1 {
                font-size: 1.8rem;
            }

            .article-title {
                font-size: 1.5rem;
            }

            .article-subtitle {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>Lector de Notícies</h1>
            <p class="subtitle">Visualitza articles de La Vanguardia en format llegible</p>
        </header>

        <section class="input-section">
            <input type="text" class="url-input" id="urlInput"
                   placeholder="Enganxa la URL de la notícia de La Vanguardia"
                   value="https://www.lavanguardia.com/qf/20250725/10924059/aceites-virgenes-extra-mas-mediterraneos-brl.html">
            <button class="btn" id="loadBtn">Carregar Contingut</button>
        </section>

        <div class="loading" id="loadingIndicator">
            <div class="spinner"></div>
            <p>Carregant contingut...</p>
        </div>

        <section class="content-section" id="contentSection">
            <!-- El contingut es carregarà aquí -->
        </section>

        <footer>
            <p>Lector de notícies - Dissenyat per millorar la llegibilitat d'articles periodístics</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('urlInput');
            const loadBtn = document.getElementById('loadBtn');
            const contentSection = document.getElementById('contentSection');
            const loadingIndicator = document.getElementById('loadingIndicator');

            // Carregar contingut en fer clic al botó
            loadBtn.addEventListener('click', loadContent);

            // També carregar contingut en prémer Enter al camp de URL
            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    loadContent();
                }
            });

            async function loadContent() {
                const url = urlInput.value.trim();

                if (!url) {
                    showError('Si us plau, introdueix una URL vàlida');
                    return;
                }

                if (!url.includes('lavanguardia.com')) {
                    showError('Si us plau, introdueix una URL de La Vanguardia');
                    return;
                }

                try {
                    // Mostrar indicador de càrrega
                    loadingIndicator.style.display = 'block';
                    contentSection.innerHTML = '';
                    loadBtn.disabled = true;

                    // Utilitzar un proxy CORS per evitar problemes de same-origin policy
                    const proxyUrl = 'https://api.allorigins.win/raw?url=';
                    const response = await fetch(proxyUrl + encodeURIComponent(url));

                    if (!response.ok) {
                        throw new Error(`Error en carregar la pàgina: ${response.status}`);
                    }

                    const html = await response.text();

                    // Extreure les dades del JSON-LD
                    const articleData = extractArticleData(html);

                    // Extreure totes les imatges de la notícia
                    const articleImages = extractAllArticleImages(html);

                    // Ocultar indicador de càrrega
                    loadingIndicator.style.display = 'none';
                    loadBtn.disabled = false;

                    // Mostrar el contingut processat
                    displayContent(articleData, articleImages);

                } catch (error) {
                    loadingIndicator.style.display = 'none';
                    loadBtn.disabled = false;
                    showError(`Error en carregar el contingut: ${error.message}`);
                    console.error('Error:', error);
                }
            }

            function extractArticleData(html) {
                // Buscar el script amb JSON-LD
                const scriptRegex = /<script type="application\/ld\+json">(.*?)<\/script>/s;
                const match = html.match(scriptRegex);

                if (!match || !match[1]) {
                    throw new Error('No es van trobar dades estructurades a la pàgina');
                }

                try {
                    const jsonData = JSON.parse(match[1]);

                    // Extreure la informació rellevant
                    return {
                        title: jsonData.headline || 'Títol no disponible',
                        subtitle: jsonData.alternativeHeadline || '',
                        date: formatDate(jsonData.datePublished) || 'Data no disponible',
                        source: jsonData.publisher?.name || 'La Vanguardia',
                        section: jsonData.articleSection || 'Secció no disponible',
                        summary: jsonData.description || '',
                        body: jsonData.articleBody ? formatArticleBody(jsonData.articleBody) : 'Contingut no disponible',
                        keywords: jsonData.keywords ? (Array.isArray(jsonData.keywords) ? jsonData.keywords : jsonData.keywords.split(',')) : [],
                        author: jsonData.author ? (Array.isArray(jsonData.author) ? jsonData.author.map(a => a.name).join(', ') : jsonData.author.name) : 'Autor no disponible'
                    };
                } catch (parseError) {
                    throw new Error('Error en processar les dades estructurades');
                }
            }

            function extractAllArticleImages(html) {
                const images = [];

                // Buscar totes les etiquetes picture
                const pictureRegex = /<picture[^>]*>.*?<\/picture>/gs;
                const pictureMatches = html.match(pictureRegex);

                if (pictureMatches) {
                    pictureMatches.forEach(pictureHtml => {
                        // Extreure la imatge de cada etiqueta picture
                        const imgMatch = pictureHtml.match(/<img[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/);
                        if (imgMatch && imgMatch[1]) {
                            images.push({
                                src: imgMatch[1],
                                alt: imgMatch[2] || 'Imatge de la notícia',
                                type: 'picture'
                            });
                        }
                    });
                }

                // Buscar imatges directes que no estiguin dins de picture
                const directImgRegex = /<img[^>]*class="[^"]*nolazy[^"]*"[^>]*src="([^"]*)"[^>]*alt="([^"]*)"[^>]*>/g;
                let directImgMatch;
                while ((directImgMatch = directImgRegex.exec(html)) !== null) {
                    // Verificar que aquesta imatge no estigui ja inclosa des de les etiquetes picture
                    const alreadyIncluded = images.some(img => img.src === directImgMatch[1]);
                    if (!alreadyIncluded) {
                        images.push({
                            src: directImgMatch[1],
                            alt: directImgMatch[2] || 'Imatge de la notícia',
                            type: 'direct'
                        });
                    }
                }

                // Buscar imatges del JSON-LD
                const scriptRegex = /<script type="application\/ld\+json">(.*?)<\/script>/s;
                const scriptMatch = html.match(scriptRegex);
                if (scriptMatch && scriptMatch[1]) {
                    try {
                        const jsonData = JSON.parse(scriptMatch[1]);
                        if (jsonData.image) {
                            if (Array.isArray(jsonData.image)) {
                                jsonData.image.forEach(img => {
                                    if (img.url && !images.some(existingImg => existingImg.src === img.url)) {
                                        images.push({
                                            src: img.url,
                                            alt: img.caption || 'Imatge de la notícia',
                                            type: 'json-ld'
                                        });
                                    }
                                });
                            } else if (jsonData.image.url && !images.some(existingImg => existingImg.src === jsonData.image.url)) {
                                images.push({
                                    src: jsonData.image.url,
                                    alt: jsonData.image.caption || 'Imatge de la notícia',
                                    type: 'json-ld'
                                });
                            }
                        }
                    } catch (e) {
                        console.log('No es van poder extreure imatges del JSON-LD');
                    }
                }

                return images;
            }

            function formatDate(dateString) {
                if (!dateString) return '';
                try {
                    const date = new Date(dateString);
                    return date.toLocaleDateString('ca-ES', {
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                } catch {
                    return dateString;
                }
            }

            function formatArticleBody(body) {
                if (!body) return '';

                // Netejar i formatar el cos de l'article
                let formattedBody = body
                    .replace(/&nbsp;/g, ' ')
                    .replace(/\s+/g, ' ')
                    .trim();

                // Dividir en paràgrafs (basat en punts o salts de línia)
                const paragraphs = formattedBody.split(/\.\s+/);

                // Crear paràgrafs HTML
                return paragraphs.map(paragraph => {
                    if (paragraph.trim()) {
                        return `<p>${paragraph.trim()}.</p>`;
                    }
                    return '';
                }).join('');
            }

            function displayContent(articleData, articleImages) {
                // Construir l'HTML de les imatges
                let imagesHTML = '';
                if (articleImages.length > 0) {
                    imagesHTML = `
                        <div class="article-images">
                            <div class="images-info">
                                S'han trobat ${articleImages.length} imatge(s) en aquest article
                            </div>
                            ${articleImages.map((image, index) => `
                                <div class="article-image">
                                    <div class="image-counter">Imatge ${index + 1} de ${articleImages.length}</div>
                                    <img src="${image.src}" alt="${image.alt}" onerror="this.style.display='none'">
                                    <div class="image-caption">${image.alt}</div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // Construir l'HTML de l'article
                const articleHTML = `
                    <div class="article-header">
                        <h2 class="article-title">${articleData.title}</h2>
                        ${articleData.subtitle ? `<p class="article-subtitle">${articleData.subtitle}</p>` : ''}

                        <div class="meta-info">
                            <div class="meta-item"><strong>Data:</strong> ${articleData.date}</div>
                            <div class="meta-item"><strong>Mitjà:</strong> ${articleData.source}</div>
                            <div class="meta-item"><strong>Secció:</strong> ${articleData.section}</div>
                            <div class="meta-item"><strong>Autor:</strong> ${articleData.author}</div>
                        </div>
                    </div>

                    ${imagesHTML}

                    ${articleData.summary ? `
                    <div class="summary">
                        <h3>Resum</h3>
                        <p>${articleData.summary}</p>
                    </div>
                    ` : ''}

                    <div class="article-body">
                        ${articleData.body}
                    </div>

                    ${articleData.keywords && articleData.keywords.length > 0 ? `
                    <div class="keywords">
                        <h3>Paraules clau</h3>
                        ${articleData.keywords.map(keyword => `<span>${keyword.trim()}</span>`).join('')}
                    </div>
                    ` : ''}
                `;

                // Inserir el contingut a la pàgina
                contentSection.innerHTML = articleHTML;
            }

            function showError(message) {
                contentSection.innerHTML = `
                    <div class="error">
                        <strong>Error:</strong> ${message}
                    </div>
                `;
            }

            // Carregar contingut automàticament en obrir la pàgina
            loadContent();
        });
    </script>
</body>
</html>