 <!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de Vídeo HLS</title>
    <style>
        body {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            height: 100vh;
            margin: 0;
        }
        video {
            width: 100%;
            height: auto;
            aspect-ratio: 16 / 9;
        }
        .controls {
            display: flex;
            justify-content: center;
            margin-top: 10px;
        }
        button {
            margin: 0 5px;
        }
        .channel-buttons-container {
            width: 100%;
            flex-grow: 1;
            overflow-y: auto;
            border-top: 1px solid #ccc; /* Optional styling */
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
        }
        .channel-button {
            display: flex;
            align-items: center;
            margin: 5px;
            padding: 5px;
        }
        .channel-button img {
            width: 30px;
            height: 30px;
            margin-right: 5px;
        }
        .active-channel {
            background-color: #d3d3d3; /* Color de fons per al canal actiu */
        }
    </style>
</head>
<body>
    <video id="videoPlayer" controls></video>
    <div class="controls">
        <button id="play">Play</button>
        <button id="pause">Pause</button>
        <button id="stop">Stop</button>
        <button id="prevChannel">Canal Anterior</button>
        <button id="nextChannel">Canal Següent</button>
        <button id="mute">Mute</button>
        <button id="volDown">Vol -</button>
        <button id="volUp">Vol +</button>
    </div>
    <div class="channel-buttons-container" id="channelButtons"></div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script>
        const video = document.getElementById('videoPlayer');
        const playButton = document.getElementById('play');
        const pauseButton = document.getElementById('pause');
        const stopButton = document.getElementById('stop');
        const prevChannelButton = document.getElementById('prevChannel');
        const nextChannelButton = document.getElementById('nextChannel');
        const muteButton = document.getElementById('mute');
        const volDownButton = document.getElementById('volDown');
        const volUpButton = document.getElementById('volUp');

        let hls = new Hls();
        let currentChannelIndex = 0; // Index del canal actual
        let channels = []; // Array per emmagatzemar els canals

        // Funció per carregar els canals des del fitxer M3U
        fetch('https://xarxa-1.github.io/Xarxa-1/cat17.m3u')
            .then(response => response.text())
            .then(data => {
                console.log("Dades M3U carregades:", data); // Comprovació de dades carregades
                const lines = data.split('\n');
                for (let i = 0; i < lines.length; i++) {
                    if (lines[i].startsWith('#EXTINF')) {
                        const [info, url] = [lines[i], lines[i + 1]];
                        if (url && url.startsWith('http')) { // Comprova que la URL sigui vàlida
                            const match = info.match(/tvg-logo="([^"]+)"/);
                            const logo = match ? match[1] : '';
                            const name = info.split(',')[1].trim();
                            channels.push({ name, url, logo });
                            i++; // Skip the URL line
                        } else {
                            console.error("URL no vàlida trobada:", url);
                        }
                    }
                }
                console.log("Canals processats:", channels); // Comprovació de canals processats
                if (channels.length > 0) {
                    loadChannel(currentChannelIndex);
                    createChannelButtons();
                    highlightActiveChannel();
                } else {
                    console.error("No s'han trobat canals.");
                }
                
            })
            .catch(error => console.error("Error carregant el fitxer M3U:", error));

        
         function loadChannel(index) {
             if (hls) {
                 hls.destroy();
                 hls = new Hls();
             }

             // Comprova si l'índex és vàlid abans de carregar el canal
             if (channels[index]) {
                 hls.loadSource(channels[index].url);
                 hls.attachMedia(video);
                 video.play();
                 highlightActiveChannel();
             } else {
                 console.error("Canal no vàlid:", index);
             }
         }

         function createChannelButtons() {
             const channelButtonsDiv =
                 document.getElementById("channelButtons");

             channelButtonsDiv.innerHTML = ""; // Neteja botons existents

             channels.forEach((channel, index) => {
                 const button = document.createElement("div");
                 button.className = "channel-button";
                 button.innerHTML =
                     `<img src="${channel.logo}" alt="${channel.name} logo"> ${channel.name}`;
                 button.onclick = () => {
                     currentChannelIndex =
                         index; // Actualitza l'índex del canal actual
                     loadChannel(index); // Carrega el canal seleccionat
                 };
                 channelButtonsDiv.appendChild(button);
             });

             highlightActiveChannel(); // Assegura que el canal actiu estigui destacat

             // Desplaça automàticament al canal actiu
             if (channels.length > 0) {
                 document.querySelectorAll(".channel-button")[
                     currentChannelIndex
                 ].scrollIntoView({ behavior: "smooth", block: "nearest" });
             }
         }

         function highlightActiveChannel() {
             const channelButtonsDivs =
                 document.querySelectorAll(".channel-button");

             channelButtonsDivs.forEach((button, index) => {
                 if (index === currentChannelIndex) {
                     button.classList.add(
                         "active-channel"
                     ); // Afegir classe al canal actiu
                 } else {
                     button.classList.remove(
                         "active-channel"
                     ); // Treure classe dels canals inactius
                 }
             });
         }

         playButton.onclick = () => video.play();
         pauseButton.onclick = () => video.pause();
         stopButton.onclick = () => {
             video.pause();
             video.currentTime = 0;
         };

         prevChannelButton.onclick = () => {
             currentChannelIndex =
                 (currentChannelIndex - 1 + channels.length) % channels.length; // Canal anterior
             loadChannel(currentChannelIndex);
         };

         nextChannelButton.onclick = () => {
             currentChannelIndex =
                 (currentChannelIndex + 1) % channels.length; // Canal següent
             loadChannel(currentChannelIndex);
         };

         muteButton.onclick = () => (video.muted = !video.muted); // Mutar

         volDownButton.onclick = () =>
             (video.volume = Math.max(0, video.volume - 0.1)); // Volum -

         volUpButton.onclick = () =>
             (video.volume = Math.min(1, video.volume + 0.1)); // Volum +
    </script>
</body>
</html>
