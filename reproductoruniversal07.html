<!DOCTYPE html>
<html lang="ca">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=yes" />
    <meta name="mobile-web-app-capable" content="yes" />
    <link rel="icon" type="image/png" href="https://www.livehdtv.com/uploads/img/2022/03/31583vector2.png" />

  <title>Streaming Multiformat</title>

  <!-- Video.js CSS -->
  <link
    href="https://vjs.zencdn.net/8.10.0/video-js.css"
    rel="stylesheet"
  />

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: #101018;
      color: #f0f0f0;
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      padding: 10px 20px;
      background: #151520;
      border-bottom: 1px solid #333;
      z-index: 1000;
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    #left-info {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #clock {
      font-size: 18px;
      font-weight: bold;
      color: #00e0ff;
    }

    #current-channel {
      display: flex;
      align-items: center;
      gap: 6px;
      max-width: 250px;
      overflow: hidden;
      white-space: nowrap;
    }

    #current-channel-logo {
      width: 24px;
      height: 24px;
      border-radius: 4px;
      object-fit: contain;
      background: #222;
      flex-shrink: 0;
    }

    #current-channel-name {
      font-size: 13px;
      color: #ddd;
      text-overflow: ellipsis;
      overflow: hidden;
    }

    header h1 {
      font-size: 18px;
      color: #ddd;
    }

    main {
      padding: 70px 20px 20px 20px;
      max-width: 1200px;
      margin: 0 auto;
    }

    /* Player 16:9 */
    .video-wrapper {
      position: relative;
      width: 100%;
      max-width: 1200px;
      margin: 0 auto;
      background: #000;
    }

    .video-wrapper::before {
      content: "";
      display: block;
      padding-top: 56.25%;
    }

    .video-js {
      position: absolute;
      top: 0;
      left: 0;
      width: 100% !important;
      height: 100% !important;
    }

    /* Botons sota el player */
    .video-buttons {
      margin-top: 10px;
      display: flex;
      gap: 10px;
      flex-wrap: wrap;
    }

    .btn {
      cursor: pointer;
      padding: 8px 14px;
      border-radius: 4px;
      border: 1px solid #444;
      background: #1e1e2a;
      color: #f0f0f0;
      font-size: 14px;
      transition: background 0.2s, transform 0.1s;
    }

    .btn:hover {
      background: #29293a;
      transform: translateY(-1px);
    }

    .btn-primary {
      border-color: #00e0ff;
      color: #00e0ff;
    }

    /* Zona inferior: canals + input M3U */
    .layout-bottom {
      margin-top: 20px;
      display: grid;
      grid-template-columns: minmax(0, 2fr) minmax(260px, 1fr);
      gap: 20px;
    }

    .channel-list {
      background: #151520;
      border-radius: 8px;
      border: 1px solid #333;
      max-height: 350px;
      overflow-y: auto;
      padding: 10px;
    }

    .channel-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 8px 6px;
      border-radius: 6px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .channel-item:hover {
      background: #232337;
    }

    .channel-item.current {
      background: #00e0ff20;
      border: 1px solid #00e0ff40;
    }

    .channel-logo {
      width: 48px;
      height: 48px;
      background: #333;
      border-radius: 4px;
      flex-shrink: 0;
      object-fit: contain;
    }

    .channel-info {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 2px;
      min-width: 0;
    }

    .channel-name {
      font-weight: bold;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .channel-desc {
      font-size: 11px;
      color: #aaa;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .m3u-loader {
      background: #151520;
      border-radius: 8px;
      border: 1px solid #333;
      padding: 12px 12px 14px 12px;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .m3u-loader label {
      font-size: 14px;
      color: #bbb;
    }

    .m3u-loader input[type="text"] {
      width: 100%;
      padding: 8px 10px;
      border-radius: 4px;
      border: 1px solid #444;
      background: #12121b;
      color: #f0f0f0;
      font-size: 13px;
    }

    .m3u-loader small {
      font-size: 12px;
      color: #777;
    }

    @media (max-width: 900px) {
      .layout-bottom {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <header>
    <div id="left-info">
      <div id="clock">00:00:00</div>
      <div id="current-channel">
        <img id="current-channel-logo" src="https://via.placeholder.com/24x24?text=--" alt="Canal" />
        <span id="current-channel-name">Carregant...</span>
      </div>
    </div>
    <h1>Streaming</h1>
  </header>

  <main>
    <!-- PLAYER PRINCIPAL 16:9 -->
    <div class="video-wrapper">
      <video
        id="main-player"
        class="video-js vjs-default-skin"
        controls
        preload="none"
        data-setup='{
          "controls": true,
          "autoplay": false,
          "preload": "none",
          "fluid": true,
          "liveui": true,
          "controlBar": {
            "playToggle": true,
            "volumePanel": {"inline": false},
            "currentTimeDisplay": true,
            "timeDivider": true,
            "durationDisplay": true,
            "remainingTimeDisplay": true,
            "progressControl": true,
            "liveDisplay": true,
            "seekToLive": true,
            "playbackRateMenuButton": true,
            "chaptersButton": true,
            "descriptionsButton": true,
            "subsCapsButton": true,
            "audioTrackButton": true,
            "pictureInPictureToggle": true,
            "fullscreenToggle": true
          }
        }'
      >
      </video>
    </div>

    <!-- Botons sota el vÃ­deo -->
    <div class="video-buttons">
      <button class="btn btn-primary" id="btnPlayPause">Play/Pausa</button>
      <button class="btn" id="btnMuteToggle">Silencia/Activa so</button>
      <button class="btn" id="btnPrevChannel">â—€ Anterior</button>
      <button class="btn" id="btnNextChannel">SegÃ¼ent â–¶</button>
    </div>

    <!-- Zona inferior: canals + loader M3U -->
    <div class="layout-bottom">
      <div class="channel-list" id="channelList">
        <!-- Es genera amb JS -->
      </div>

      <div class="m3u-loader">
        <label for="m3uUrl">
          URL de llista M3U / M3U8:
        </label>
        <input
          type="text"
          id="m3uUrl"
          value="https://xarxa-1.github.io/Xarxa-1/cat19.m3u"
        />
        <button class="btn btn-primary" id="btnLoadM3U">
          ðŸ”„ Recarrega llista
        </button>
        <small>
          <strong>âœ“</strong> Gener 2026
        </small>
      </div>
    </div>
  </main>

  <!-- Video.js JS -->
  <script src="https://vjs.zencdn.net/8.10.0/video.min.js"></script>

  <script>
    /* Rellotge hh:mm:ss */
    function updateClock() {
      const clockEl = document.getElementById("clock");
      const now = new Date();
      const hh = String(now.getHours()).padStart(2, "0");
      const mm = String(now.getMinutes()).padStart(2, "0");
      const ss = String(now.getSeconds()).padStart(2, "0");
      clockEl.textContent = hh + ":" + mm + ":" + ss;
    }
    setInterval(updateClock, 1000);
    updateClock();

    /* Player Video.js */
    const player = videojs("main-player");

    document.getElementById("btnPlayPause").addEventListener("click", function () {
      if (player.paused()) {
        player.play();
      } videojs("main-player");
    });

    document.getElementById("btnMuteToggle").addEventListener("click", function () {
      player.muted(!player.muted());
    });

    /* Estat de canals per als botons anterior/segÃ¼ent */
    let channelsState = [];
    let currentChannelIndex = -1;

    function updateCurrentChannelHeader(ch, index) {
      const logoEl = document.getElementById("current-channel-logo");
      const nameEl = document.getElementById("current-channel-name");

      if (!ch) {
        logoEl.src = "https://via.placeholder.com/24x24?text=--";
        nameEl.textContent = "Cap canal seleccionat";
        return;
      }

      const logoUrl = ch.logo && ch.logo.length > 0
        ? ch.logo
        : `https://via.placeholder.com/24x24?text=${encodeURIComponent(
            (index + 1).toString()
          )}`;
      logoEl.src = logoUrl;
      logoEl.onerror = function () {
        logoEl.src = "https://via.placeholder.com/24x24?text=CH";
      };
      nameEl.textContent = ch.name || `Canal ${index + 1}`;
    }

    function updateChannelListHighlight(index) {
      const items = document.querySelectorAll(".channel-item");
      items.forEach((item, i) => {
        item.classList.toggle("current", i === index);
      });
    }

    function playChannelByIndex(index) {
      if (!channelsState.length) return;
      if (index < 0 || index >= channelsState.length) return;

      const ch = channelsState[index];
      if (!ch.url) return;

      currentChannelIndex = index;
      player.src({
        src: ch.url,
        type: "application/vnd.apple.mpegurl"
      });
      player.play();

      updateCurrentChannelHeader(ch, index);
      updateChannelListHighlight(index);
    }

    document.getElementById("btnPrevChannel").addEventListener("click", function () {
      if (!channelsState.length) return;
      if (currentChannelIndex <= 0) {
        playChannelByIndex(channelsState.length - 1);
      } else {
        playChannelByIndex(currentChannelIndex - 1);
      }
    });

    document.getElementById("btnNextChannel").addEventListener("click", function () {
      if (!channelsState.length) return;
      if (currentChannelIndex >= channelsState.length - 1 || currentChannelIndex === -1) {
        playChannelByIndex(0);
      } else {
        playChannelByIndex(currentChannelIndex + 1);
      }
    });

    /* CÃ rrega inicial AUTOMÃ€TICA del primer canal */
    window.addEventListener("load", async () => {
      const defaultUrl = document.getElementById("m3uUrl").value.trim();
      if (defaultUrl) {
        await loadM3UList(defaultUrl);
        // REPRODUIR EL PRIMER CANAL AUTOMÃ€TICAMENT
        if (channelsState.length > 0) {
          playChannelByIndex(0);
        }
      }
    });

    document.getElementById("btnLoadM3U").addEventListener("click", async function () {
      const url = document.getElementById("m3uUrl").value.trim();
      if (!url) {
        alert("Introdueix una URL vÃ lida.");
        return;
      }
      await loadM3UList(url);
      // Reproduceix el primer canal tambÃ© quan es recarrega manualment
      if (channelsState.length > 0) {
        playChannelByIndex(0);
      }
    });

    async function loadM3UList(url) {
      try {
        const res = await fetch(url);
        if (!res.ok) {
          alert("No s'ha pogut carregar la llista M3U");
          return;
        }
        const text = await res.text();
        const channels = parseM3U(text);
        channelsState = channels;
        currentChannelIndex = -1;
        renderChannelList(channels);
        updateCurrentChannelHeader(null, -1);
      } catch (err) {
        console.error(err);
        alert("Error en carregar la llista (CORS/xarxa).");
      }
    }

    /* Parser simple M3U/M3U8 */
    function parseM3U(text) {
      const lines = text.split(/\r?\n/);
      const channels = [];
      let currentInfo = null;

      for (let raw of lines) {
        const line = raw.trim();
        if (!line || line.startsWith("#EXTM3U")) continue;

        if (line.startsWith("#EXTINF")) {
          currentInfo = { name: "Canal sense nom", logo: "", url: "" };

          const parts = line.split(",");
          if (parts.length > 1) {
            currentInfo.name = parts.slice(1).join(",").trim();
          }

          const logoMatch = line.match(/tvg-logo="([^"]*)"/i);
          if (logoMatch) {
            currentInfo.logo = logoMatch[1];
          }
        } else if (!line.startsWith("#") && currentInfo) {
          currentInfo.url = line;
          channels.push(currentInfo);
          currentInfo = null;
        }
      }

      return channels;
    }

    function renderChannelList(channels) {
      const container = document.getElementById("channelList");
      container.innerHTML = "";

      if (!channels.length) {
        container.innerHTML = "<p>No s'han trobat canals a la llista.</p>";
        return;
      }

      channels.forEach((ch, idx) => {
        const item = document.createElement("div");
        item.className = "channel-item";
        item.dataset.index = idx.toString();
        item.title = ch.name || "";

        const logo = document.createElement("img");
        logo.className = "channel-logo";
        logo.alt = ch.name || "Canal";

        const logoUrl = ch.logo && ch.logo.length > 0
          ? ch.logo
          : `https://via.placeholder.com/48x48?text=${encodeURIComponent(
              (idx + 1).toString()
            )}`;
        logo.src = logoUrl;
        logo.onerror = function () {
          logo.src = "https://via.placeholder.com/48x48?text=CH";
        };

        const info = document.createElement("div");
        info.className = "channel-info";

        const nameEl = document.createElement("div");
        nameEl.className = "channel-name";
        nameEl.textContent = ch.name || `Canal ${idx + 1}`;

        const descEl = document.createElement("div");
        descEl.className = "channel-desc";
        const shortUrl = (ch.url || "").length > 50
          ? ch.url.slice(0, 47) + "..."
          : ch.url || "";
        descEl.textContent = shortUrl;

        info.appendChild(nameEl);
        info.appendChild(descEl);

        item.appendChild(logo);
        item.appendChild(info);

        item.addEventListener("click", () => {
          playChannelByIndex(idx);
        });

        container.appendChild(item);
      });
    }
  </script>
</body>
</html>

