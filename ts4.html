<!DOCTYPE html>
<html lang="ca">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
 <meta name="viewport" content="initial-scale=1.0, width=device-width, user-scalable=yes" /> <meta name="apple-mobile-web-app-capable" content="yes"> <meta name="mobile-web-app-capable" content="yes" /> <meta name="theme-color" content="#002017" /> <link rel="icon" sizes="32x32" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpFNDY1NDg3RDc3N0JFODExODNENjlCOEE4NDIwQ0ZCMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpBNzIyRUYxOUU2OEMxMUU5OENDMkRGRDY2MUEyMUNEMCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpBNzIyRUYxOEU2OEMxMUU5OENDMkRGRDY2MUEyMUNEMCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjBBQzRBRDc4OEJFNkU5MTE5RDNFOEE4MDBCRkY0NDZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU0NjU0ODdENzc3QkU4MTE4M0Q2OUI4QTg0MjBDRkIzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+6G+jpQAAA/9JREFUeNq0V1lIlFEU/kZbjPYkEysospJGbBW1KAgX2qCHFIpepOVBBFHBpiQiIjIXFIveUiIhCcqXVoPqoZ0CM1qgtB5EsEItNR2TtHO8d3Lm/8//z6/pgY9h/nvvOd+992zXNbR+PRzKDMJOwlbCGsJSwmw99pPwhfCa8JBwi9DjRKnLAYFogoewjzDdIdlfhFpCMaHJbmKIzVgY4SzhHeHQKIxDzz2k1xZrXaMisIzwTO98CsYuvPaI1hVtT+DVKwVgHeGJvufxEtb1eFj3iB3hBDZsYJZ3CQsw/rJgWLeyITrhNH1Uq23VREQACQnA8uVAeDjw5w/Q0QG8eaN21tUVjAhNRCKhj/9M8hs4aWvc5QJSU4H0dMDtBqZONc/p7QWuXQOqqykILaMwTtvy+J8AO90HwmRnGYFSQloacOAAEBlpHm9tBXJzKTN8sdIwQFjFIerzgaOWxtlYUlLgN95dXR2QkQHU15vXLFwIXLigrkuWydrmsBPO1ElGmEbzSkuB8nIgPt483kfXePw4cOWK7CsVFUBoqBWJvWybCewQkwzf+YkTyrCPSEyMWc3QkDJ05455bOVK2to+u2S1gwkki8PZ2cD27YFXcf48sHixTKKoCPj2zTx2+DDtc6YVieQQ7ZWBwp6emWmePncucO6c+pUioLZW2CdtNCXFMiJCdASMCO/a47GOAD4BPvIwIb03NMhrOG9YpHwmMOvfX75vvne+fzuJjQXOnCEXNpSSzk55flSUlaZZnAf6xYJz+TJF6irzkt27VZz/S+ZEoqwM2LIleP4YoPDPyQFevvR9+c1bkHOnvxF/mTcv8P/gIFBYCLx9a2+c55065W+cpYsJNIsLHj2SFa1da/7m9QJ5eUBLizWBkhIpVJtDdHEwy4MHQHe3+fv+/cqzjcL3z8cr+cGlS6pGCIWJCdwXCfCuamrM37kCHjsmOyqfQFZWYCHiXXNaluU+E7itezizMIGPH83ft20D8vNlEk3UAhYUKIfj++Z750QlZA627auGFwkHRRKLFgFVVWrnRrl3Dzh9WiUho3ABa2yUx5RUcd/oI8BdynvLirhkCVBZqaqcUdraVP1nMj2OOnFfOaamAp9CT6ok0aH7/k3i9B8/gBs3VMyvWKGKk3+N2LxZFZ1EanT6Ka18/hyMAJVXXJVasudibTDmdk6tcXEqJzCp9nZ19y9eyAXJ3JIlaR/wI8D9nGoYnxLmY2LkO2Ej2WoiW0JXzAPk44SvE2D867BuZSPo04xP4nrQ63AufOx7pGea1cuIJ3INLdEeO1YZ0DoSrN6Idm9Dr26d3TpP9I7CcJ+Oc7fW4f2f17H/83yX4Xk+xxeohuf5TafP878CDADrJR+o7JYu7QAAAABJRU5ErkJggg==" /> <link rel="icon" sizes="16x16" type="image/png" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAA2ZpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuMy1jMDExIDY2LjE0NTY2MSwgMjAxMi8wMi8wNi0xNDo1NjoyNyAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wTU09Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9tbS8iIHhtbG5zOnN0UmVmPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvc1R5cGUvUmVzb3VyY2VSZWYjIiB4bWxuczp4bXA9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC8iIHhtcE1NOk9yaWdpbmFsRG9jdW1lbnRJRD0ieG1wLmRpZDpFNDY1NDg3RDc3N0JFODExODNENjlCOEE4NDIwQ0ZCMyIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDpDOTY4QjBGRUU2OEMxMUU5QUJBRkE5MTJCOTQzRkZDRCIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDpDOTY4QjBGREU2OEMxMUU5QUJBRkE5MTJCOTQzRkZDRCIgeG1wOkNyZWF0b3JUb29sPSJBZG9iZSBQaG90b3Nob3AgQ1M2IChXaW5kb3dzKSI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOkRDQjYyN0M2OENFNkU5MTE5RDNFOEE4MDBCRkY0NDZDIiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOkU0NjU0ODdENzc3QkU4MTE4M0Q2OUI4QTg0MjBDRkIzIi8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+GozsaQAAAeZJREFUeNqkkztIXFEQhr/daFBQUAuxErJYxcAKPrCwiikUU1lppcWmyANhC8HKwkZByIJgICSF2GhlFxDUVBaiWyQQU0lILC1UUFTUuPln59zca5AQyMB/75xzZv4zr5MqtbfzhzwUckK/8CDsfRNWhffC16RxqlQqudbRcV/f18JzIc3dciO8E/IUi+cxgTt/EJ7wb/KxHGGxeFkRNgq3nOvqYGQEslmokMnuLiwtwf5+ZPE4RPsqpRq0Svks3Csf1dfD0ZGSUBa9vTA+Dg0NcHEBExOwuRmR/BSy6VAwd25pgZUVBaf63SjdtTWd5pywqgqmp6GpKSIwn5wR9JWXjY0wNwe1tTA5CZ2dbmZhFwquV1fD6GiyFn1GkKGmxp2NxKSyEmZnPSKTra3YpasrSZDxdp2ewtBQskgwOAh7e3FakTQ3w/Iy5UvhMh2GxGV7Ozbs7va/kVghr658fXAAY2N+KfxIhwlzWViAszPX83m/zWRnB6am4OTEnY3EZd3a+EjKp9+d6OmBmRmv+uGh12Jjw7ti7bS9uI1t0STOa/HiVp7Dw9CqEbm+Fr34Fxfh+DhZwDeaxJf/PcreBSn6Dgjz4cHwl8f0VngafEjd8ZxttJ+FActYq4TvVrDwnL8kjX8JMAAn8plXACq+3AAAAABJRU5ErkJggg==" /><link rel="apple-touch-icon-precomposed" sizes="180x180" href="https://static.convertio.co/img/apple-touch-icon-180x180-precomposed.png" /> <link rel="apple-touch-icon-precomposed" sizes="167x167" href="https://static.convertio.co/img/apple-touch-icon-167x167-precomposed.png" /> <link rel="apple-touch-icon-precomposed" sizes="152x152" href="https://static.convertio.co/img/apple-touch-icon-152x152-precomposed.png" /> <link rel="apple-touch-icon-precomposed" sizes="120x120" href="https://static.convertio.co/img/apple-touch-icon-120x120-precomposed.png" /> <link rel="apple-touch-icon-precomposed" sizes="76x76" href="https://static.convertio.co/img/apple-touch-icon-76x76-precomposed.png" /> <link rel="apple-touch-icon-precomposed" href="https://static.convertio.co/img/apple-touch-icon-180x180-precomposed.png" /> 
    <title>TeleSrteaming</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            height: 100%;
            display: flex;
            flex-direction: column;
            background-color: black;
        }

        #video-container {width: 100vw; /* Amplada completa de la pantalla */ height: 100vh; /* Alçada completa de la pantalla */ display: flex;  
            
            background-color: black;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        #videoPlayer {width: 100vw; /* Amplada completa de la pantalla */ height: 56.25vw; /* 56.25 és 100 * (9/16) per mantenir la proporció 16:9 */ max-height: 98vh; /* Assegura que el vídeo no passi de l'alçada de la pantalla */ max-width: 100%; /* Assegura que el vídeo no surti de l'amplada de la pantalla */ object-fit: cover; /* Assegura que el vídeo cobreixi tot l'espai del reproductor */ }

        #controls-container {
            padding: 10px;
            background-color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
      background-color: black;  }

        #channelSelect {
            margin-bottom: 10px;
            padding: 5px;background-color: black; color:gold;font-size: 16px;
        }

        #channelDetails {background-color: darkgray; color: white;
            display: flex;
            justify-content: center;
            align-items: center;
            list-style-type: none;
            padding: 0;
            margin: 0;
            overflow-y: auto;
            max-height: 150px;
            width: 100%;
            flex-wrap: wrap;
        }

        #channelDetails li {
            margin: 5px;
            padding: 10px;
            border: 1px solid #ccc;
            display: flex;
            flex-direction: column;
            align-items: center;
            cursor: pointer;
            background: DarkSlateGray;
        }

        #channelDetails li.active {
            background-color: #c0c0c0;
        }

        #channelDetails img {
            max-width: 50px;
            margin-bottom: 5px;
        }

        button {background-color: gold;
            padding: 10px;
            margin: 5px;
            cursor: pointer;
        }

        button:focus {
            outline: none;
        }

        /* Ajusta l'alçada del reproductor de vídeo */
        @media (min-width: 768px) {
            #videoPlayer {
                max-height: 500px;
            }
        }
        
 list-style: background-color: black;none;
            padding: 0;
            width: 100%;
            max-height: 200px;
            overflow-y: auto; /* Permet que la llista sigui desplaçable si és massa llarga */
        }

        #channelDetails li {
            display: flex;
            align-items: center;
            padding: 10px;
            cursor: pointer;
            border: 1px solid #ddd;width: 50px;
            height: 50px;
            margin-bottom: 10px;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        #channelDetails li.active {
            background-color: gold;
            color: blue;
        }

        #channelDetails li:hover {
            background-color: gold;
        }

        #channelDetails img {
            width: 50px;
            height: 50px;
            margin-right: 10px;
        }       
        
    </style>
</head>
<body>

    <!-- Contenidor del reproductor de vídeo -->
    <div id="video-container">
        <video id="videoPlayer" controls autoplay muted>
            El teu navegador no suporta la reproducció de vídeos en streaming.
        </video>
    </div>

    <!-- Contenidor dels controls i canals -->
    <div id="controls-container">
        <select id="channelSelect"></select>
        <div>
            <center><button id="prevChannel">Canal Anterior</button>
            <button id="nextChannel">Canal Següent</button><button id="playPause">Play/Pause</button>
                
    <button id="volumeDown">Volum -</button><button id="volumeUp">Volum +</button>
   </center>         
        </div>        
        <ul id="channelDetails"></ul>
    </div>

    <!-- Afegim HLS.js -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const videoPlayer = document.getElementById('videoPlayer');
            const playPauseBtn = document.getElementById('playPause');
            const prevChannelBtn = document.getElementById('prevChannel');
            const nextChannelBtn = document.getElementById('nextChannel');
            const volumeUpBtn = document.getElementById('volumeUp');
            const volumeDownBtn = document.getElementById('volumeDown');
            const channelSelect = document.getElementById('channelSelect');
            const channelDetails = document.getElementById('channelDetails');

            let channels = [];
            let currentChannelIndex = 0;

            // URL predeterminada
            const defaultUrl = 'https://directes-tv-cat.ccma.cat/live-origin/tv3-hls/master.m3u8';

            // Funció per carregar els canals des de l'URL
            function loadChannels() {
                fetch('https://raw.githubusercontent.com/Xarxa-1/Xarxa-1/refs/heads/gh-pages/cat18.m3u')
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('No s\'ha pogut carregar el fitxer M3U');
                        }
                        return response.text();
                    })
                    .then(data => {
                        channels = parseM3U(data);
                        if (channels.length > 0) {
                            populateChannelSelect();
                            populateChannelList();
                            playChannel(0); // Començar pel primer canal
                        } else {
                            console.error('No s\'han trobat canals al fitxer M3U');
                        }
                    })
                    .catch(error => {
                        console.error('Error en carregar els canals:', error);
                        playDefaultChannel();  // Reproduir el canal per defecte en cas d'error
                    });
            }

            // Funció per reproduir el canal per defecte
            function playDefaultChannel() {
                playStream(defaultUrl);
            }

            // Funció per analitzar el fitxer M3U
            function parseM3U(data) {
                const lines = data.split('\n');
                const channelList = [];
                let currentChannel = {};

                lines.forEach(line => {
                    if (line.startsWith('#EXTINF')) {
                        const logoMatch = line.match(/tvg-logo="([^"]+)"/);
                        const nameMatch = line.match(/,([^\n]+)/);
                        currentChannel = {
                            name: nameMatch ? nameMatch[1].trim() : '',
                            logo: logoMatch ? logoMatch[1].trim() : ''
                        };
                    } else if (line.startsWith('http')) {
                        currentChannel.url = line.trim();
                        if (currentChannel.name && currentChannel.url) {
                            channelList.push(currentChannel);
                        }
                    }
                });

                return channelList;
            }

            // Funció per omplir el select de canals
            function populateChannelSelect() {
                channels.forEach((channel, index) => {
                    const option = document.createElement('option');
                    option.value = index;
                    option.textContent = channel.name;
                    channelSelect.appendChild(option);
                });
            }

            // Funció per omplir la llista de canals amb detalls
            function populateChannelList() {
                channels.forEach((channel, index) => {
                    const li = document.createElement('li');
                    li.dataset.index = index;

                    const img = document.createElement('img');
                    img.src = channel.logo;
                    li.appendChild(img);

                    const name = document.createElement('span');
                    name.textContent = channel.name;
                    li.appendChild(name);

                    li.addEventListener('click', () => {
                        playChannel(index);
                    });

                    channelDetails.appendChild(li);
                });
            }

            // Funció per reproduir un canal
            function playChannel(index) {
                if (channels.length === 0) return; // Si no hi ha canals, no fer res
                currentChannelIndex = index;
                playStream(channels[index].url);
                updateActiveChannel();
            }

            // Funció per actualitzar el canal actiu
            function updateActiveChannel() {
                document.querySelectorAll('#channelDetails li').forEach(li => {
                    li.classList.remove('active');
                });
                const activeLi = document.querySelector(`#channelDetails li[data-index="${currentChannelIndex}"]`);
                if (activeLi) {
                    activeLi.classList.add('active');
                }
                channelSelect.value = currentChannelIndex;
            }

            // Funció per reproduir un flux amb hls.js
            function playStream(url) {
                if (Hls.isSupported()) {
                    const hls = new Hls();
                    hls.loadSource(url);
                    hls.attachMedia(videoPlayer);
                    hls.on(Hls.Events.MANIFEST_PARSED, function() {
                        videoPlayer.play();
                    });
                } else if (videoPlayer.canPlayType('application/vnd.apple.mpegurl')) {
                    videoPlayer.src = url;
                    videoPlayer.play();
                } else {
                    console.error('El format no és suportat pel navegador.');
                }
            }

            // Controladors dels botons
            playPauseBtn.addEventListener('click', () => {
                if (videoPlayer.paused) {
                    videoPlayer.play();
                } else {
                    videoPlayer.pause();
                }
            });

            prevChannelBtn.addEventListener('click', () => {
                currentChannelIndex = (currentChannelIndex > 0) ? currentChannelIndex - 1 : channels.length - 1;
                playChannel(currentChannelIndex);
            });

            nextChannelBtn.addEventListener('click', () => {
                currentChannelIndex = (currentChannelIndex < channels.length - 1) ? currentChannelIndex + 1 : 0;
                playChannel(currentChannelIndex);
            });

            volumeUpBtn.addEventListener('click', () => {
                videoPlayer.volume = Math.min(videoPlayer.volume + 0.1, 1);
            });

            volumeDownBtn.addEventListener('click', () => {
                videoPlayer.volume = Math.max(videoPlayer.volume - 0.1, 0);
            });

            // Canviar canal amb el select
            channelSelect.addEventListener('change', () => {
                playChannel(parseInt(channelSelect.value));
            });

            // Carregar els canals al carregar la pàgina
            loadChannels();
        });
    </script>
</body>
</html>
